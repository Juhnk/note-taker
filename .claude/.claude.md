# Claude Code Development Workflow

## Project Overview

**NoteTaker** is a minimal, personal note-taking application for iOS and macOS built with Swift, SwiftUI, Core Data, and CloudKit.

**Key Principles:**
- Maximum simplicity
- Core Data (NOT SwiftData - it's too immature)
- Minimal design (white, greys, black - no colors until Phase 2)
- No emojis anywhere
- Production-ready, stable technologies

---

## Project Context

### Current Status
- Planning phase complete
- Documentation finalized
- Ready to start Xcode project creation
- Using Core Data instead of SwiftData based on 2024-2025 research

### Tech Stack
- **Language**: Swift 5.9+
- **UI**: SwiftUI
- **Data**: Core Data with NSPersistentCloudKitContainer
- **Sync**: CloudKit (private database)
- **Platforms**: iOS 17+, macOS 14+
- **Timeline**: 9 months (MVP in 3 months)

### Why Core Data Over SwiftData?
SwiftData has critical production issues:
- Significant bugs in iOS 17 and iOS 18
- Performance degrades with 10,000+ notes
- Developers actively abandoning it
- Core Data is battle-tested (15+ years)
- All successful note apps use Core Data

---

## Documentation Structure

Always read these files before making changes:

### Primary Docs (Read First)
1. **docs/PROJECT_PLAN.md** - Features, timeline, phases, decisions
2. **docs/ARCHITECTURE.md** - Technical architecture, Core Data models, file structure
3. **docs/DESIGN_SYSTEM.md** - UI/UX guidelines, colors, typography, spacing
4. **docs/GITHUB_WORKFLOW.md** - Git workflow, commit messages, PR process

### Additional Context
- **README.md** - Project overview and setup
- **CHANGELOG.md** (when created) - Version history
- **Code comments** - Inline documentation

### Progress Tracking & Testing
- **PROGRESS.md** - Main progress tracker with checkboxes (UPDATE AFTER EACH CYCLE!)
- **docs/TESTING.md** - Testing guidelines and requirements
- **docs/DEVELOPMENT_CYCLES.md** - Cycle management to avoid AI overload

---

## Progress Tracking

### CRITICAL: Always Use PROGRESS.md

**Rule**: Check and update PROGRESS.md for EVERY task.

**Before starting work**:
1. Read PROGRESS.md to find current sprint
2. Verify what tasks are complete
3. Identify what to work on next

**After completing work**:
1. Check off completed tasks in PROGRESS.md
2. Update sprint status
3. Note actual time vs estimated time
4. Add any learnings or blockers

### Testing Requirements

**No code is complete without tests.**

**Progressive Coverage Targets** (see docs/TESTING.md):
- Sprint 0: Disabled (empty project)
- Sprint 1-2: 40% minimum
- Sprint 3-5: 50% minimum
- Sprint 6-9: 60% minimum
- Sprint 10+: 70% minimum (final target)

**Component Targets** (goals, not blockers):
- Core Data Models & Services: 80%
- ViewModels: 85%
- Views: 60%
- Utilities: 75%

**Test-Driven Development (TDD)**:
1. Write failing test first
2. Implement minimum code to pass
3. Refactor if needed
4. Repeat

**Pre-Commit Hook** (FAST - ~30 seconds):
- SwiftLint (code quality)
- Debug print check
- Quick syntax validation
- **NO builds, NO tests, NO coverage** (too slow)
- Total time: ~30 seconds ⚡

**CI/CD Pipeline** (COMPREHENSIVE):
- Full iOS and macOS builds
- Full test suites
- Coverage checks (progressive targets)
- **Blocks merge if fails** (quality gate)
- Validates commit messages
- Checks documentation updates

**Philosophy**:
- Pre-commit = Fast feedback (30 sec)
- CI/CD = Quality enforcement (blocks merge)
- Progressive coverage = Practical approach

See docs/TESTING.md for complete testing guidelines.

### Development Cycles

**Rule: 2-3 Days Maximum Per Cycle**

To avoid AI context overload and ensure steady progress:
- Maximum 2-3 days per cycle
- Maximum 1-3 features per cycle
- Each cycle includes: implementation, tests, docs, manual testing, commit

**If a cycle takes longer than 3 days, STOP and break it down.**

See docs/DEVELOPMENT_CYCLES.md for complete cycle management guidelines.

---

## Development Workflow

### Before Starting ANY Task

**CRITICAL**: Always check PROGRESS.md first to see what sprint you're working on!

1. **Read PROGRESS.md**:
   - Find current sprint and tasks
   - Verify prerequisites are complete
   - Check estimated time and test coverage targets

2. **Read relevant documentation**:
   - Check PROJECT_PLAN.md for feature requirements
   - Check ARCHITECTURE.md for implementation approach
   - Check DESIGN_SYSTEM.md for UI guidelines
   - Check TESTING.md for testing requirements
   - Check DEVELOPMENT_CYCLES.md for cycle size guidelines

### Development Cycle (2-3 Days Maximum)

**Rule: Every cycle MUST be 2-3 days maximum. If longer, break it down.**

Each cycle includes:
1. Planning (15 min) - Read docs, verify prerequisites
2. Implementation (1-2 days) - TDD: Write tests first, then code
3. Testing (half day) - Unit, integration, manual testing
4. Documentation (1 hour) - Update PROGRESS.md, other docs if needed
5. Review & Commit (30 min) - Self-review, lint, commit
6. Reflection (15 min) - What went well? Any blockers?

See docs/DEVELOPMENT_CYCLES.md for complete cycle guidelines.

### When Starting a New Task

1. **Check PROGRESS.md** - What sprint/task are you on?

2. **Read documentation first**:
   - Check PROJECT_PLAN.md for feature requirements
   - Check ARCHITECTURE.md for implementation approach
   - Check DESIGN_SYSTEM.md for UI guidelines
   - Check TESTING.md for testing approach

3. **Create feature branch**:
   ```bash
   git checkout -b feature/task-description
   ```

4. **Write tests FIRST (TDD)**:
   - Write failing test
   - Implement minimum code to pass
   - Refactor if needed
   - Repeat

5. **Implement following architecture**:
   - Use Core Data models (see ARCHITECTURE.md)
   - Follow MVVM pattern
   - Match design system (DESIGN_SYSTEM.md)
   - Add accessibility labels
   - Support Dynamic Type

6. **Test thoroughly**:
   - Run unit tests (coverage ≥ 70%)
   - Run integration tests
   - Run on iOS simulator
   - Run on macOS
   - Test dark mode
   - Test accessibility (VoiceOver)
   - Test with Dynamic Type

7. **Update PROGRESS.md**:
   - Check off completed tasks
   - Update sprint status
   - Note any issues or learnings

8. **Commit with conventional commits**:
   ```bash
   git commit -m "feat(scope): description"
   ```
   Note: Pre-commit hook will run automatically (~30 seconds) and block commit if:
   - SwiftLint fails
   - Debug prints found (with confirmation)
   - Syntax errors detected

   Full validation (builds, tests, coverage) happens in CI/CD

9. **Create Pull Request** (see GITHUB_WORKFLOW.md)
   - CI/CD will run automatically
   - All tests must pass before merge
   - Code coverage must meet progressive target (see docs/TESTING.md)
   - PR will be blocked if CI/CD fails

### Code Style Guidelines

**Swift Style**:
- Follow Swift API Design Guidelines
- Use meaningful variable names
- Avoid force-unwrapping (!) unless absolutely necessary
- Use guard for early returns
- Prefer let over var
- Use extensions to organize code

**SwiftUI Style**:
- Break down views into small components
- Keep Views "dumb" (no business logic)
- Use @Observable for ViewModels (iOS 17+)
- Prefer composition over inheritance
- Extract reusable components to Components/ folder

**Core Data Style**:
- Use NSFetchedResultsController for lists
- Always save on main context
- Handle errors appropriately
- Use predicates for filtering
- Index frequently queried attributes

**Comments**:
- Comment the "why", not the "what"
- Use `// MARK: -` to organize code sections
- Document complex algorithms
- Add TODO/FIXME only when necessary

---

## File Organization

### Where to Put New Files

**Models** (`Models/`):
- Core Data entities (auto-generated)
- Extensions to entities
- Enums and helper types

**Views** (`Views/`):
- `Home/` - Main screen, note list
- `Editor/` - Note editing
- `Components/` - Reusable UI components
- `Settings/` - App settings

**ViewModels** (`ViewModels/`):
- One ViewModel per main feature
- Use @Observable macro
- Handle business logic

**Services** (`Services/`):
- PersistenceController (Core Data setup)
- CoreDataService (CRUD operations)
- SearchService
- AttachmentService

**Utilities** (`Utilities/`):
- Extensions (`Extensions/`)
- Constants (`Constants.swift`)
- Helpers

---

## Common Tasks

### Adding a New Feature

1. **Check PROJECT_PLAN.md** - Is it in current phase?
2. **Read ARCHITECTURE.md** - How should it integrate?
3. **Create branch**: `feature/feature-name`
4. **Implement**:
   - Add Core Data entity if needed (update .xcdatamodeld)
   - Create ViewModel
   - Create Views
   - Follow DESIGN_SYSTEM.md
   - Add tests
5. **Test** on iOS and macOS
6. **Commit** with conventional message
7. **Create PR**

### Fixing a Bug

1. **Create branch**: `bugfix/issue-number-description`
2. **Write test that reproduces bug** (if possible)
3. **Fix bug**
4. **Verify test passes**
5. **Commit**: `fix(scope): description\n\nFixes #issue-number`
6. **Create PR**

### Updating Documentation

1. **Create branch**: `docs/what-changed`
2. **Update relevant .md files**
3. **Commit**: `docs: description of changes`
4. **Create PR** (fast-track, doesn't need extensive review)

### Refactoring

1. **Create branch**: `refactor/what-refactored`
2. **Ensure tests pass before and after**
3. **Make changes** (no behavior change)
4. **Commit**: `refactor(scope): description`
5. **Create PR**

---

## Design System Quick Reference

### Colors (Phase 1)
- Background: `Color(.systemBackground)`
- Text: `Color(.label)`
- Secondary: `Color(.secondaryLabel)`
- **NO custom colors**
- **NO emojis**

### Spacing
```swift
.padding(.spacingXS)   // 8pt
.padding(.spacingM)    // 16pt (default)
.padding(.spacingL)    // 24pt (sections)
```

### Typography
```swift
.font(.largeTitle)     // Titles
.font(.title2)         // Headings
.font(.body)           // Default text
.font(.footnote)       // Metadata
```

### Icons
```swift
Image(systemName: "plus")           // Add
Image(systemName: "trash")          // Delete
Image(systemName: "magnifyingglass") // Search
```

---

## Core Data Patterns

### Fetching Notes
```swift
let request = Note.fetchRequest()
request.predicate = NSPredicate(format: "folder == %@", folder)
request.sortDescriptors = [NSSortDescriptor(keyPath: \Note.modifiedAt, ascending: false)]
let notes = try? context.fetch(request)
```

### Creating a Note
```swift
let note = Note(context: viewContext)
note.id = UUID()
note.title = "New Note"
note.createdAt = Date()
note.modifiedAt = Date()
try viewContext.save()
```

### Using NSFetchedResultsController
```swift
let request = Note.fetchRequest()
request.sortDescriptors = [NSSortDescriptor(keyPath: \Note.modifiedAt, ascending: false)]
fetchedResultsController = NSFetchedResultsController(
    fetchRequest: request,
    managedObjectContext: context,
    sectionNameKeyPath: nil,
    cacheName: nil
)
```

---

## Testing Checklist

Before marking task complete:

- [ ] Unit tests written and passing
- [ ] Test coverage meets progressive target (see docs/TESTING.md)
- [ ] Feature works on iOS
- [ ] Feature works on macOS
- [ ] Dark mode looks correct
- [ ] Dynamic Type works
- [ ] VoiceOver accessible
- [ ] No force-unwraps (!)
- [ ] No hardcoded values
- [ ] No debug print statements
- [ ] Follows DESIGN_SYSTEM.md
- [ ] Core Data saves work
- [ ] No crashes or warnings
- [ ] SwiftLint passes
- [ ] Pre-commit hook passes (~30 seconds)
- [ ] CI/CD passes (builds, tests, coverage)
- [ ] PROGRESS.md updated with completion
- [ ] Documentation updated (if architecture/design changed)

---

## Common Pitfalls

### Don't
- Use SwiftData (use Core Data)
- Add emojis to UI
- Use custom colors in Phase 1
- Force-unwrap optionals
- Hardcode strings (use Localizable.strings)
- Ignore accessibility
- Commit directly to main
- Mix unrelated changes in one commit
- Use custom fonts
- Override system appearance

### Do
- Follow ARCHITECTURE.md patterns
- Use Core Data properly
- Add accessibility labels
- Support Dynamic Type
- Test on both iOS and macOS
- Commit frequently with clear messages
- Ask questions if unclear
- Read documentation before coding
- Keep views simple and small
- Handle errors gracefully

---

## Commit Message Examples

**Good:**
```
feat(editor): add rich text formatting toolbar

Implemented formatting toolbar with bold, italic, underline,
and heading options. Uses iOS 18 native AttributedString support.

Refs #12
```

```
fix(sync): prevent duplicate notes on CloudKit sync

Added cloudKitRecordID tracking to prevent duplicate note
creation when syncing across devices.

Fixes #34
```

```
docs: update ARCHITECTURE.md with NSFetchedResultsController example
```

**Bad:**
```
Update
Fixed stuff
WIP
changes
```

---

## Getting Help

### When Stuck

1. **Read documentation** - Answer might be there
2. **Check ARCHITECTURE.md** - See if pattern exists
3. **Search codebase** - Similar code might exist
4. **Apple Documentation** - Official Core Data, SwiftUI docs
5. **Add TODO comment** - Mark for later discussion

### Before Asking

- Have you read relevant docs?
- Have you checked Apple's documentation?
- Can you describe the specific problem?
- What have you tried?
- Can you provide code snippet?

---

## Phase Guidelines

### Phase 1 (Current - Months 1-3): MVP
**Focus**: Core functionality only
- Core Data setup
- Basic note CRUD
- Folder organization
- Search
- CloudKit sync

**Defer**:
- Advanced formatting
- Attachments
- Tags
- Export/import

### Phase 2 (Months 4-6): Enhanced
After MVP works reliably, add:
- Image/video attachments
- Tags
- Markdown preview
- Export functionality
- Color introduction for folders

### Phase 3 (Months 7-9): Polish
After Phase 2 complete:
- Performance optimization
- Advanced features
- App Store preparation

**Current Rule**: If it's not in Phase 1 of PROJECT_PLAN.md, defer it.

---

## Key Decisions Made

These are locked in, don't revisit:

1. **Core Data over SwiftData** - SwiftData too immature (2024-2025)
2. **CloudKit for sync** - Native, free, automatic with Core Data
3. **No block-based editor** - Too complex, no Swift libraries
4. **No editable tables** - Requires months of custom work
5. **No macOS whiteboarding** - PencilKit not available
6. **Minimal design** - White, greys, black only until Phase 2
7. **No emojis** - Ever (user requirement)
8. **iOS 17+, macOS 14+** - Leverages latest APIs
9. **9-month timeline** - Realistic based on research

---

## Quick Links

- PROJECT_PLAN.md - `/docs/PROJECT_PLAN.md`
- ARCHITECTURE.md - `/docs/ARCHITECTURE.md`
- DESIGN_SYSTEM.md - `/docs/DESIGN_SYSTEM.md`
- GITHUB_WORKFLOW.md - `/docs/GITHUB_WORKFLOW.md`

---

## Summary

Working on NoteTaker with Claude Code:
1. **Check PROGRESS.md** before starting any work
2. Read docs before coding (PROJECT_PLAN, ARCHITECTURE, DESIGN_SYSTEM, TESTING)
3. Follow **2-3 day cycle maximum** (see DEVELOPMENT_CYCLES.md)
4. **Write tests FIRST** (TDD approach, progressive coverage targets)
5. Follow architecture patterns (Core Data, NOT SwiftData)
6. Match design system (minimal, no emojis, no custom colors in Phase 1)
7. Test on both platforms (iOS and macOS)
8. **Update PROGRESS.md** after completing tasks
9. Commit with conventional messages (fast pre-commit hook ~30 sec)
10. Keep it minimal and clean

**Pre-commit hook is FAST (~30 seconds):**
- SwiftLint, debug prints, syntax check only
- No builds, no tests, no coverage

**CI/CD blocks merges without passing tests:**
- Full builds, full tests, coverage checks
- Enforces progressive coverage targets
- Quality gate that prevents bad code

**No code is complete without tests.**

**When in doubt, check the docs or ask.**
